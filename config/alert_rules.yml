# ğŸš€ Prometheuså‘Šè­¦è§„åˆ™ - AIé‡åŒ–äº¤æ˜“ç³»ç»Ÿ
# é’ˆå¯¹é«˜é¢‘äº¤æ˜“å’ŒAIæ¨¡å‹çš„å…³é”®å‘Šè­¦

groups:
  # ğŸ”¥ ç³»ç»Ÿç¡¬ä»¶å‘Šè­¦
  - name: hardware_alerts
    rules:
      # CPUä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 90
        for: 2m
        labels:
          severity: critical
          component: hardware
        annotations:
          summary: "CPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} CPUä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡90%é˜ˆå€¼"

      # å†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighMemoryUsage
        expr: (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100 > 85
        for: 2m
        labels:
          severity: critical
          component: hardware
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} å†…å­˜ä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡85%é˜ˆå€¼"

      # GPUä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighGPUUsage
        expr: nvidia_gpu_utilization > 95
        for: 5m
        labels:
          severity: warning
          component: gpu
        annotations:
          summary: "GPUä½¿ç”¨ç‡è¿‡é«˜"
          description: "GPU {{ $labels.gpu }} ä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡95%é˜ˆå€¼"

      # GPUæ¸©åº¦å‘Šè­¦
      - alert: HighGPUTemperature
        expr: nvidia_gpu_temperature_celsius > 80
        for: 1m
        labels:
          severity: critical
          component: gpu
        annotations:
          summary: "GPUæ¸©åº¦è¿‡é«˜"
          description: "GPU {{ $labels.gpu }} æ¸©åº¦ä¸º {{ $value }}Â°Cï¼Œè¶…è¿‡80Â°Cé˜ˆå€¼"

      # ç£ç›˜ä½¿ç”¨ç‡å‘Šè­¦
      - alert: HighDiskUsage
        expr: (1 - (node_filesystem_avail_bytes{fstype!="tmpfs"} / node_filesystem_size_bytes{fstype!="tmpfs"})) * 100 > 85
        for: 5m
        labels:
          severity: warning
          component: storage
        annotations:
          summary: "ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å®ä¾‹ {{ $labels.instance }} ç£ç›˜ {{ $labels.mountpoint }} ä½¿ç”¨ç‡ä¸º {{ $value }}%"

  # ğŸ“Š æ•°æ®åº“å‘Šè­¦
  - name: database_alerts
    rules:
      # Redisè¿æ¥æ•°å‘Šè­¦
      - alert: RedisHighConnections
        expr: redis_connected_clients > 8000
        for: 2m
        labels:
          severity: warning
          component: redis
        annotations:
          summary: "Redisè¿æ¥æ•°è¿‡é«˜"
          description: "Redisè¿æ¥æ•°ä¸º {{ $value }}ï¼Œè¶…è¿‡8000é˜ˆå€¼"

      # Rediså†…å­˜ä½¿ç”¨ç‡å‘Šè­¦
      - alert: RedisHighMemoryUsage
        expr: (redis_memory_used_bytes / redis_memory_max_bytes) * 100 > 90
        for: 2m
        labels:
          severity: critical
          component: redis
        annotations:
          summary: "Rediså†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "Rediså†…å­˜ä½¿ç”¨ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡90%é˜ˆå€¼"

      # PostgreSQLè¿æ¥æ•°å‘Šè­¦
      - alert: PostgreSQLHighConnections
        expr: pg_stat_database_numbackends > 180
        for: 2m
        labels:
          severity: warning
          component: postgresql
        annotations:
          summary: "PostgreSQLè¿æ¥æ•°è¿‡é«˜"
          description: "PostgreSQLè¿æ¥æ•°ä¸º {{ $value }}ï¼Œè¶…è¿‡180é˜ˆå€¼"

      # ClickHouseæŸ¥è¯¢å»¶è¿Ÿå‘Šè­¦
      - alert: ClickHouseHighQueryLatency
        expr: clickhouse_query_duration_seconds{quantile="0.95"} > 5
        for: 1m
        labels:
          severity: warning
          component: clickhouse
        annotations:
          summary: "ClickHouseæŸ¥è¯¢å»¶è¿Ÿè¿‡é«˜"
          description: "ClickHouse 95%æŸ¥è¯¢å»¶è¿Ÿä¸º {{ $value }}ç§’ï¼Œè¶…è¿‡5ç§’é˜ˆå€¼"

  # ğŸš€ åº”ç”¨æœåŠ¡å‘Šè­¦
  - name: application_alerts
    rules:
      # åº”ç”¨æœåŠ¡ä¸å¯ç”¨
      - alert: ApplicationDown
        expr: up{job="ai-trading-system"} == 0
        for: 30s
        labels:
          severity: critical
          component: application
        annotations:
          summary: "AIäº¤æ˜“ç³»ç»ŸæœåŠ¡ä¸å¯ç”¨"
          description: "AIäº¤æ˜“ç³»ç»Ÿä¸»æœåŠ¡å·²åœæ­¢å“åº”"

      # HTTPè¯·æ±‚é”™è¯¯ç‡è¿‡é«˜
      - alert: HighHTTPErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) * 100 > 5
        for: 2m
        labels:
          severity: critical
          component: application
        annotations:
          summary: "HTTPé”™è¯¯ç‡è¿‡é«˜"
          description: "HTTP 5xxé”™è¯¯ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡5%é˜ˆå€¼"

      # APIå“åº”æ—¶é—´è¿‡é•¿
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 2m
        labels:
          severity: warning
          component: application
        annotations:
          summary: "APIå“åº”æ—¶é—´è¿‡é•¿"
          description: "API 95%å“åº”æ—¶é—´ä¸º {{ $value }}ç§’ï¼Œè¶…è¿‡2ç§’é˜ˆå€¼"

  # ğŸ’° äº¤æ˜“ç³»ç»Ÿå‘Šè­¦
  - name: trading_alerts
    rules:
      # äº¤æ˜“æ‰€APIè¿æ¥å¤±è´¥
      - alert: ExchangeAPIDown
        expr: exchange_api_status == 0
        for: 30s
        labels:
          severity: critical
          component: trading
        annotations:
          summary: "äº¤æ˜“æ‰€APIè¿æ¥å¤±è´¥"
          description: "äº¤æ˜“æ‰€ {{ $labels.exchange }} APIè¿æ¥å¤±è´¥"

      # è®¢å•æ‰§è¡Œå»¶è¿Ÿè¿‡é«˜
      - alert: HighOrderLatency
        expr: order_execution_duration_seconds{quantile="0.95"} > 5
        for: 1m
        labels:
          severity: warning
          component: trading
        annotations:
          summary: "è®¢å•æ‰§è¡Œå»¶è¿Ÿè¿‡é«˜"
          description: "è®¢å•æ‰§è¡Œ95%å»¶è¿Ÿä¸º {{ $value }}ç§’ï¼Œè¶…è¿‡5ç§’é˜ˆå€¼"

      # è®¢å•å¤±è´¥ç‡è¿‡é«˜
      - alert: HighOrderFailureRate
        expr: rate(orders_failed_total[5m]) / rate(orders_total[5m]) * 100 > 10
        for: 2m
        labels:
          severity: critical
          component: trading
        annotations:
          summary: "è®¢å•å¤±è´¥ç‡è¿‡é«˜"
          description: "è®¢å•å¤±è´¥ç‡ä¸º {{ $value }}%ï¼Œè¶…è¿‡10%é˜ˆå€¼"

      # è´¦æˆ·ä½™é¢ä¸è¶³
      - alert: LowAccountBalance
        expr: account_balance_ratio < 0.1
        for: 1m
        labels:
          severity: critical
          component: trading
        annotations:
          summary: "è´¦æˆ·ä½™é¢ä¸è¶³"
          description: "è´¦æˆ· {{ $labels.account }} ä½™é¢æ¯”ä¾‹ä¸º {{ $value }}ï¼Œä½äº10%é˜ˆå€¼"

      # æŒä»“é£é™©è¿‡é«˜
      - alert: HighPositionRisk
        expr: position_risk_ratio > 0.8
        for: 1m
        labels:
          severity: critical
          component: risk
        annotations:
          summary: "æŒä»“é£é™©è¿‡é«˜"
          description: "æŒä»“ {{ $labels.symbol }} é£é™©æ¯”ä¾‹ä¸º {{ $value }}ï¼Œè¶…è¿‡80%é˜ˆå€¼"

  # ğŸ¤– AIæ¨¡å‹å‘Šè­¦
  - name: ai_model_alerts
    rules:
      # AIæ¨¡å‹è®­ç»ƒå¤±è´¥
      - alert: AIModelTrainingFailed
        expr: ai_model_training_status{status="failed"} == 1
        for: 0s
        labels:
          severity: critical
          component: ai
        annotations:
          summary: "AIæ¨¡å‹è®­ç»ƒå¤±è´¥"
          description: "AIæ¨¡å‹ {{ $labels.model_name }} è®­ç»ƒå¤±è´¥"

      # AIæ¨¡å‹é¢„æµ‹å‡†ç¡®ç‡ä¸‹é™
      - alert: LowModelAccuracy
        expr: ai_model_accuracy < 0.6
        for: 5m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "AIæ¨¡å‹é¢„æµ‹å‡†ç¡®ç‡ä¸‹é™"
          description: "AIæ¨¡å‹ {{ $labels.model_name }} å‡†ç¡®ç‡ä¸º {{ $value }}ï¼Œä½äº60%é˜ˆå€¼"

      # AIæ¨¡å‹æ¨ç†å»¶è¿Ÿè¿‡é«˜
      - alert: HighModelInferenceLatency
        expr: ai_model_inference_duration_seconds{quantile="0.95"} > 1
        for: 2m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "AIæ¨¡å‹æ¨ç†å»¶è¿Ÿè¿‡é«˜"
          description: "AIæ¨¡å‹ {{ $labels.model_name }} æ¨ç†å»¶è¿Ÿä¸º {{ $value }}ç§’ï¼Œè¶…è¿‡1ç§’é˜ˆå€¼"

  # ğŸŒ ç½‘ç»œè¿æ¥å‘Šè­¦
  - name: network_alerts
    rules:
      # äº¤æ˜“æ‰€ç½‘ç»œå»¶è¿Ÿè¿‡é«˜
      - alert: HighExchangeLatency
        expr: probe_duration_seconds{job="blackbox-http"} > 1
        for: 2m
        labels:
          severity: warning
          component: network
        annotations:
          summary: "äº¤æ˜“æ‰€ç½‘ç»œå»¶è¿Ÿè¿‡é«˜"
          description: "äº¤æ˜“æ‰€ {{ $labels.instance }} ç½‘ç»œå»¶è¿Ÿä¸º {{ $value }}ç§’ï¼Œè¶…è¿‡1ç§’é˜ˆå€¼"

      # WebSocketè¿æ¥æ–­å¼€
      - alert: WebSocketDisconnected
        expr: websocket_connections_active == 0
        for: 30s
        labels:
          severity: critical
          component: network
        annotations:
          summary: "WebSocketè¿æ¥æ–­å¼€"
          description: "äº¤æ˜“æ‰€ {{ $labels.exchange }} WebSocketè¿æ¥å·²æ–­å¼€"

  # ğŸ“ˆ ä¸šåŠ¡æŒ‡æ ‡å‘Šè­¦
  - name: business_alerts
    rules:
      # æ—¥äº¤æ˜“é‡å¼‚å¸¸
      - alert: AbnormalDailyVolume
        expr: daily_trading_volume < daily_trading_volume offset 1d * 0.5
        for: 1h
        labels:
          severity: warning
          component: business
        annotations:
          summary: "æ—¥äº¤æ˜“é‡å¼‚å¸¸"
          description: "ä»Šæ—¥äº¤æ˜“é‡ {{ $value }} ä½äºæ˜¨æ—¥çš„50%"

      # ç­–ç•¥æ”¶ç›Šç‡å¼‚å¸¸
      - alert: NegativeStrategyReturn
        expr: strategy_daily_return < -0.05
        for: 30m
        labels:
          severity: critical
          component: business
        annotations:
          summary: "ç­–ç•¥æ”¶ç›Šç‡å¼‚å¸¸"
          description: "ç­–ç•¥ {{ $labels.strategy }} æ—¥æ”¶ç›Šç‡ä¸º {{ $value }}ï¼Œä½äº-5%é˜ˆå€¼"

      # é£é™©æŒ‡æ ‡å¼‚å¸¸
      - alert: HighDrawdown
        expr: portfolio_max_drawdown > 0.15
        for: 5m
        labels:
          severity: critical
          component: risk
        annotations:
          summary: "æœ€å¤§å›æ’¤è¿‡é«˜"
          description: "æŠ•èµ„ç»„åˆæœ€å¤§å›æ’¤ä¸º {{ $value }}ï¼Œè¶…è¿‡15%é˜ˆå€¼"
